# Настройка Mailgun для отправки электронной почты

## 1. Регистрация и настройка аккаунта Mailgun

1. Зарегистрируйтесь на [Mailgun](https://www.mailgun.com/)
2. Подтвердите свой аккаунт и добавьте платежную информацию (для production)
3. Добавьте и верифицируйте домен в Mailgun (или используйте sandbox-домен для тестирования)
4. Перейдите в раздел "Domains" и выберите ваш домен
5. В разделе "API Keys" найдите "Private API Key" для использования в вашем приложении

## 2. Настройка переменных окружения

Добавьте следующие переменные в файл `.env.local`:

```
# Mailgun (Email)
MAILGUN_API_KEY=your_api_key_here
MAILGUN_DOMAIN=your_domain_here (например, mg.yourdomain.com)
MAILGUN_WEBHOOK_SIGNING_KEY=your_webhook_signing_key_here
MAILGUN_PUBLIC_KEY=your_public_key_here
SENDER_EMAIL=no-reply@your_domain.com
```

## 3. Тестирование интеграции

1. Запустите проект:
   ```
   npm run dev
   ```

2. Перейдите на страницу тестирования Mailgun:
   ```
   http://localhost:3000/email-test
   ```

3. Введите тестовый email и имя, затем нажмите кнопку "Send Test Email"
4. Проверьте почту на доставку тестового письма

## 4. Настройка почтовых шаблонов

Для управления шаблонами в Mailgun:

1. Перейдите в раздел "Templates" в консоли Mailgun
2. Создайте новый шаблон для различных типов писем:
   - Подтверждение заказа
   - Обновление статуса доставки
   - Сброс пароля

## 5. Настройка вебхуков

Для получения уведомлений о доставке и открытии писем:

1. Перейдите в раздел "Webhooks" в консоли Mailgun
2. Настройте URL вашего вебхука: `https://your-domain.com/api/webhooks/mailgun`
3. Выберите события для отслеживания (доставка, открытие, клики, отказы)

## 6. Переход в Production

1. Убедитесь, что ваш домен полностью верифицирован в Mailgun
2. Установите лимиты отправки писем в соответствии с вашими потребностями
3. Настройте SPF и DKIM записи для улучшения доставляемости
4. Мониторьте статистику писем в консоли Mailgun

## 7. Действия при блокировке

Если ваш аккаунт был заблокирован или письма не доставляются:

1. Проверьте журналы отправки в консоли Mailgun
2. Убедитесь, что вы не нарушаете политики использования
3. Свяжитесь с поддержкой Mailgun для разрешения проблемы

## 8. Дополнительная документация

- [Документация Mailgun](https://documentation.mailgun.com/)
- [Руководство по API Mailgun](https://documentation.mailgun.com/en/latest/api_reference.html)
- [Улучшение доставляемости писем](https://www.mailgun.com/email-deliverability/) 